var URLBACK="http://salvacam.net78.net/simpleMovieBack/",Director=Backbone.Model.extend({initialize:function(){this.movies=new Movies([],{director:this})}}),Directors=Backbone.Collection.extend({model:Director,url:URLBACK,create:function(e){var t=new Director(e),i=JSON.stringify({name:t.get("name"),nationality:t.get("nationality")}),r=this;$.post(URLBACK,i,function(e){r.reset(e),postRouter.navigate("/",{trigger:!0})})}}),DirectorListView=Backbone.View.extend({tagName:"li",className:"list-group-item",template:_.template("<a href='/director/<%= id %>'><%= name %></a>"),render:function(){return this.el.innerHTML=this.template(this.model.toJSON()),this}}),DirectorsListView=Backbone.View.extend({render:function(){var e=this;return this.collection.forEach(function(t){e.el.append(new DirectorListView({model:t}).render().el)}),this.$el.prepend('<a href="/director/new">New Directors</a>'),this},events:{"click a":"handleClick"},handleClick:function(e){e.preventDefault(),postRouter.navigate($(e.currentTarget).attr("href"),{trigger:!0})}}),DirectorView=Backbone.View.extend({template:_.template($("#directorTemplate").html()),events:{"click a":"handleClick"},render:function(){return this.el.innerHTML=this.template(this.model.toJSON()),this},handleClick:function(e){e.preventDefault(),postRouter.navigate($(e.currentTarget).attr("href"),{trigger:!0})}}),DirectorFormView=Backbone.View.extend({tagName:"form",template:_.template($("#directorFormTemplate").html()),initialize:function(e){this.directors=e.directors},events:{"click button":"createDirector","click a":"handleClick"},handleClick:function(e){e.preventDefault(),postRouter.navigate($(e.currentTarget).attr("href"),{trigger:!0})},render:function(){return this.el.innerHTML=this.template(),this},createDirector:function(e){var t=_.max(this.directors.toJSON(),function(e){return e.id}),i={name:$("#directorName").val(),nationality:$("#directorNationality").val(),id:t.id+1};return this.directors.create(i),!1}}),Movie=Backbone.Model.extend({}),Movies=Backbone.Collection.extend({initialize:function(e,t){this.director=t.director},url:function(){return this.director.url()}}),MovieView=Backbone.View.extend({template:_.template($("#movieView").html()),render:function(){var e=this.model.toJSON();return this.el.innerHTML=this.template(e),this}}),MoviesView=Backbone.View.extend({initialize:function(e){this.director=e.director,this.director.movies.on("add",this.addMovie,this)},addMovie:function(e){this.$el.append(new MovieView({model:e}).render().el)},render:function(){function e(){t.director.movies.forEach(function(e){t.$el.append(new MovieView({model:e}).render().el)})}this.$el.append("<h4> Movies </h4>"),this.director.movies.fetch({reset:!0,success:e});var t=this;return this.$el.append(new MovieFormView({director:this.director}).render().el),this}}),MovieFormView=Backbone.View.extend({tagName:"form",initialize:function(e){this.director=e.director},template:_.template($("#movieFormView").html()),events:{"click button":"submitMovie"},render:function(){return this.el.innerHTML=this.template(),this},submitMovie:function(e){var t=this.$("#movieName").val(),i=this.$("#movieYear").val(),r={directorId:this.director.get("id"),movie:t,year:i};this.director.movies.create(r),this.el.reset()}}),PostRouter=Backbone.Router.extend({initialize:function(e){this.directors=e.directors},routes:{"":"index","director/new":"newDirector","director/:id":"singleDirector"},index:function(){var e=new DirectorsListView({collection:this.directors});$("#main-director").html(""),$("#list-directors").html(e.render().el)},singleDirector:function(e){var t=this.directors.get(e),i=new DirectorView({model:t});$("#list-directors").html(""),$("#main-director").html(i.render().el);var r=new MoviesView({director:t});$("#main-director").append(r.render().el)},newDirector:function(){var e=new DirectorFormView({directors:this.directors});$("#list-directors").html(""),$("#main-director").html(e.render().el)}}),postRouter;$.get(URLBACK,function(e,t){postRouter=new PostRouter({directors:new Directors(e)}),Backbone.history.start({root:"/simpleMovie/"})});